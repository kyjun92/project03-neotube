<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="video">
	<select id="select" resultType="videoVO2">
		select * from video
	</select>
	<select id="popular" resultType="joinVO">
		select v.video_title ,v.play_num , v.video_date ,v.thumbnail
		,c.channel_title ,v.video_id , c.channel_title
		,c.channel_img,v.channel_id
		from video as v
		join channel as c
		on c.channel_id = v.channel_id order by v.play_num desc
	</select>
	<select id="list" parameterType="videoVO2" resultType="videoVO2">
		select * from video where video_id = #{video_id}
	</select>
	<select id="list2" parameterType="channelVO2"
		resultType="channelVO2">
		select * from channel where channel_id = #{channel_id}
	</select>
	
	<select id="join" resultType="joinVO">
		select v.video_title ,v.play_num , v.video_date ,v.thumbnail
		,c.channel_title ,v.video_id , c.channel_title
		,c.channel_img,v.channel_id
		from video as v
		join channel as c
		on c.channel_id = v.channel_id
	</select>
	<insert id="likeinsert" parameterType="String">
		insert into user_like values(#{user_id},#{video_id},null)
	</insert>
	<select id="likeVideo" resultType="joinVideoUserlikeVO">
	select distinct * from video as v join user_like as u on v.video_id = u.video_id  ; 
	</select>
	<!-- 시청기록 db 적재 -->
	<insert id="user_recordInsert" parameterType="userrecordVO">
	 	insert into user_record values(#{user_id}, #{video_id},now())
	</insert>
	<!-- 구독 db insert문  -->
	<select id="recordView" resultType="videoVO2">
	select v.video_id,
		v.video_title, v.play_num, v.video_date, v.channel_id, v.thumbnail,v.channel_title,
		max(ur.date)
		from video v join user_record ur
		on v.video_id = ur.video_id group by video_id
		order by max(ur.date) desc
	</select>
	<select id="subscribeList" parameterType="String" resultType="videoVO2">
		select video_id,
		video_title, play_num, video_date,
		channel_id, thumbnail,video_title from video where channel_id
		in ( select
		channel_id
		from subscribe where user_id = #{user_id}
		and subscribe
		=0) order
		by video_date desc
	</select>
		<update id="updatePlaynum" parameterType="string">
		update video set play_num=play_num+1 where video_id = #{video_id}
	</update>
	
	<!-- 구독여부 -->
	<select id="subscribeBoolean" parameterType="subscribeVO" resultType="subscribeVO">
	select distinct * from subscribe where user_id = #{user_id} and channel_id = #{channel_id}
	</select>
	
	<select id="subscribeCount" resultType="int">
		select count(*) from subscribe where user_id= #{user_id} and channel_id = #{channel_id}
	</select>
	
	<!-- 구독하기  -->
	<update id="updateSubscribe1" parameterType="subscribeVO">
		update subscribe set subscribe = 1 where user_id = #{user_id} and channel_id = #{channel_id}
	</update>
	
	<!-- 구독취소  -->
		<update id="updateSubscribe0" parameterType="subscribeVO">
		update subscribe set subscribe = 0 where user_id = #{user_id} and channel_id = #{channel_id}
	</update>
	
	<select id="selectSubscribe" parameterType="subscribeVO" resultType="Integer">
		select count(*) from subscribe where user_id = #{user_id} and channel_id = #{channel_id}
	</select>

	<select id="selectSubscribe2" parameterType="subscribeVO" resultType="Integer">
		select subscribe from subscribe where user_id = #{user_id} and channel_id = #{channel_id}
	</select>
	
	<insert id="insertSubscribe" parameterType="subscribeVO">
		insert into subscribe values (#{user_id}, #{channel_id}, 0)
	</insert>
	
	
</mapper>